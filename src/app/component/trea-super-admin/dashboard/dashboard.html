<div class="clearfix"></div>
<div class="tsa-section superadminsection">
  <div>
    <div class="search-client">
      <div class="input-group">
        <span class="search-icn" id="basic-addon1">
          <i class="fa fa-search" aria-hidden="true"></i>
        </span>
        <input autocomplete="nope" type="text" class="form-control" placeholder="" aria-label=""
          aria-describedby="basic-addon1" [(ngModel)]="pageData.searchList"
          (ngModelChange)="getSearchTxt(pageData.searchList)"
          (keyup)="pageData.searchTxt = util.searchInList($event, pageData.searchList)">
        <button mat-raised-button class="client-btn" (click)="pageData.searchTxt = pageData.searchList">Search</button>
      </div>
    </div>
    <div class="filter-search"></div>
    <div class="add-client">
      <button mat-raised-button class="client-btn" routerLink="/su/tsa/company-registration" type="button">New
        Company</button>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="trea-data-table">
    <table class="table table-striped">
      <thead>
        <tr>
          <th width="220">
            <div class="table-hdr text-center">
              <div>
                <span>Date</span>
                <span
                  (click)="pageData.sortColumnType='N';pageData.sortColumn = 'created_at';pageData.sortOrder = pageData.sortColumn === 'created_at' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'created_at' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.createdSearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="400">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Company</span>
                <span
                  (click)="pageData.sortColumnType='A';pageData.sortColumn = 'company_name';pageData.sortOrder = pageData.sortColumn === 'company_name' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'company_name' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.compSearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="200">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Country</span>
                <span
                  (click)="pageData.sortColumnType='A';pageData.sortColumn = 'country_name';pageData.sortOrder = pageData.sortColumn === 'country_name' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'country_name' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.countrySearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="140">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Currency</span>
                <span
                  (click)="pageData.sortColumnType='A';pageData.sortColumn = 'currency';pageData.sortOrder = pageData.sortColumn === 'currency' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'currency' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.currencySearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="260">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Payment Status</span>
                <span
                  (click)="pageData.sortColumnType='A';pageData.sortColumn = 'payment_status';pageData.sortOrder = pageData.sortColumn === 'payment_status' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'payment_status' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.paymentSearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="260">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Account Status</span>
                <span
                  (click)="pageData.sortColumnType='A';pageData.sortColumn = 'account_status';pageData.sortOrder = pageData.sortColumn === 'account_status' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'account_status' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.accountSearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="100">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Price Per User</span>
                <span
                  (click)="pageData.sortColumnType='N';pageData.sortColumn = 'price_per_user';pageData.sortOrder = pageData.sortColumn === 'price_per_user' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'price_per_user' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.pricePerUserSearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
          <th width="50">
            <div class="bdr-left table-hdr text-center">
              <div>
                <span>Users</span>
                <span
                  (click)="pageData.sortColumnType='N';pageData.sortColumn = 'users';pageData.sortOrder = pageData.sortColumn === 'users' ? pageData.sortOrder === 'ASC' ? 'DSC' : 'ASC' : 'ASC'">
                  <i [ngClass]=" pageData.sortColumn == 'users' && pageData.sortOrder == 'ASC' ? 'fa-rotate-90' : 'fa-rotate-270' "
                    class="fa fa-signal" aria-hidden="true"></i>
                </span>
              </div>
              <div>
                <input autocomplete="nope" type="text" class="form-control" [(ngModel)]="pageData.userSearch"
                  placeholder="" aria-label="" aria-describedby="basic-addon1">
              </div>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let indx=index ;let company of companyList | sortBy:pageData.sortColumn:pageData.sortOrder:pageData.sortColumnType | searchfilter:pageData.createdSearch:'created_at' |  searchfilter:pageData.compSearch:'company_name' |  searchfilter:pageData.countrySearch:'country_name' | searchfilter:pageData.currencySearch:'currency' | searchfilter:pageData.paymentSearch:'payment_status' | searchfilter:pageData.accountSearch:'account_status' |searchfilter:pageData.pricePerUserSearch:'price_per_user'| searchfilter:pageData.userSearch:'users'| searchfilter:pageData.searchTxt:'created_at,company_name,country_name,currency,payment_status,account_status,price_per_user' | listLengthfilter | paginate: paginationKey"
          (click)="getSelectedCompany(company.company_id, indx);"
          [ngClass]="[selectedIndex == indx ? 'sel-row-highlight' : '',company.payment_status == 'Past Due 90' ? 'pastDue' : company.payment_status == 'Past Due' ? 'pastDue' : company.payment_status == 'Due' ? 'pastDue' :'']">
          <!-- [ngClass]="[selectedIndex == indx ? 'sel-row-highlight' : '',company.payment_status == 'Past Due 90' ? 'pastDue-90' : company.payment_status == 'Past Due' ? 'pastDue' : company.payment_status == 'Due' ? 'Due' :'']" -->
          <td>{{util.getFormatedDate(company.created_at)}}<span
              class="dn">{{ indx == 0 ? updateCount(companyList.length) : ''}}</span></td>
          <td>{{company.company_name}}</td>
          <td>{{company.country_name}}</td>
          <td>{{company.currency}}</td>
          <td>{{company.payment_status}}</td>
          <td>{{company.account_status}}</td>
          <td>{{ company.currency_sign ? company.currency_sign : ''}}{{company.price_per_user}}</td>
          <td class="text-center"><a href="javascrip:void(0)" class="link-clr"
              [routerLink]="['/su/tsa/users-list/', company.company_id, '0']">{{company.users}}</a></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="treaPagination" *ngIf="companyList.length != 0 && constant.ITEM_COUNT != 0">
    <div class="pull-right">
      <span> {{1+(paginationKey.currentPage-1)*paginationKey.itemsPerPage}} -
        {{(paginationKey.itemsPerPage <= listCount) && (paginationKey.itemsPerPage+(paginationKey.currentPage-1)*paginationKey.itemsPerPage <= listCount) ? paginationKey.itemsPerPage+(paginationKey.currentPage-1)*paginationKey.itemsPerPage : listCount}}</span><span>
        of {{listCount}} items</span>
    </div>
    <div class="pull-right">
      <select [(ngModel)]="paginationKey.itemsPerPage">
        <option *ngFor="let pageNo of constant.PAGINATION_ITEMS" [ngValue]="pageNo"> {{pageNo}} </option>
      </select>
      <span> items per page</span>
    </div>
    <!-- (pageChange)="paginationKey.currentPage = $event" -->
    <div class="pull-right">
      <pagination-controls (pageChange)="paginationKey.currentPage = $event" directionLinks="true" autoHide="false"
        previousLabel="Pre" nextLabel="Next" screenReaderPaginationLabel="Pagination" screenReaderPageLabel="page"
        screenReaderCurrentLabel="You're on page">
      </pagination-controls>
    </div>
    <div class="clearfix"></div>
  </div>
</div>


<div id="compMark" class="selDivSection" *ngIf="selCompany">
  <div class="selDiv">
    <span>{{selCompany.company_name}}</span>
    <div class="pull-right select-btn">
      <div class="dropdown">
        <button mat-raised-button (click)="editCompany()" class="loc-btn dropdown-toggle edit-loc-btn"
          type="button">Edit
        </button>
        <!-- data-toggle="dropdown" -->
        <!-- <ul class="dropdown-menu" style="right: 0px !important;left: auto;">
                    <li><a (click)="editCompany()" href="javascript:void(0)" class="loc-btn">Edit Information</a></li>
                    <li><a (click)="showDeleteClassPopup()" href="javascript:void(0)" class="loc-btn" >Delete</a></li>
                </ul> -->
      </div>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="row">
    <form autocomplete="off" [formGroup]="editAccDetailsFrm">
      <div class="col-sm-6">
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Company</div>
          </div>
          <div class="col-sm-8">
            <div class="info-col">{{selCompany.company_name}}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Address </div>
          </div>
          <div class="col-sm-8">
            <div class="info-col">{{util.concatenateStrings(selCompany.address_line2,selCompany.address_line1)}}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Price Per User</div>
          </div>
          <div class="col-sm-8">
            <div class="info-col">{{selCompany.price_per_user}}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Currency</div>
          </div>
          <div class="col-sm-8">
            <div class="info-col">{{selCompany.currency}}</div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Main Phone</div>
          </div>
          <div class="col-sm-8">
            <div class="info-col">{{util.maskPhoneNumber(selCompany.main_phone)}}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Payment Status</div>
          </div>
          <div class="col-sm-8">
            <div class="info-col" *ngIf="!isEdit">{{selCompany.payment_status_details.status}}</div>
            <div class="info-col form-group" *ngIf="isEdit">

              <select formControlName="payment_status" class="form-control">

                <option *ngFor="let item of pageData.paymentStatusList" [value]="item.type_id">{{item.status}}</option>
              </select>

            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Country</div>
          </div>
          <div class="col-sm-8">
            <div class="info-col">{{selCompany.country_name}}</div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="label-col">Account Status</div>
          </div>
          <div class="col-sm-8">
            <!-- *ngIf="pageData.isEdit" -->
            <div *ngIf="!isEdit" class="info-col">{{selCompany.account_status_details.status}}</div>
            <div *ngIf="isEdit" class="info-col form-group">
              <!-- formControlName="UOM" -->
              <select formControlName="account_status" class="form-control">
                <!-- <option [value]='' selected>Please Select UOM</option> -->
                <option *ngFor="let item of pageData.accountStatusList" [value]="item.type_id">{{item.status}}</option>
              </select>
              <!-- <span class="error-msg" *ngIf="UOM.invalid && (UOM.dirty || UOM.touched || pageData.submitted)">
                            <small *ngIf="UOM.errors.required">Please Select UOM.</small>
                        </span> -->
            </div>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>



      <div class="col-sm-6" *ngIf="!isEdit">
        <div class="row MT20" *ngFor="let indx = index; let user of selCompany.authorized_users">
          <div class="clearfix">
            <label class="col-md-6 control-label pageSubTitle" for="supplierType">
              <span class="selDiv" *ngIf="indx == 0">Primary User</span>
              <span *ngIf="indx != 0">User {{indx+1}}</span>
            </label>
          </div>
          <div class="clearfix">
            <label class="col-sm-4 label-col" for="comment">Name</label>
            <div class="col-md-8 info-col">
              {{user.first_name}}
            </div>
          </div>
          <div class="clearfix">
            <label class="col-sm-4 label-col" for="comment">Username</label>
            <div class="col-sm-8 info-col">
              {{user.username}}
            </div>
          </div>
          <div class="clearfix">
            <label class="col-sm-4 label-col" for="comment">Designation</label>
            <div class="col-sm-8 info-col">
              {{user.user_details.designation}}
            </div>
          </div>
          <div class="clearfix">
            <label class="col-sm-4 label-col" for="comment">Email</label>
            <div class="col-sm-8 info-col">
              {{user.email_id}}
            </div>
          </div>
          <div class="clearfix">
            <label class="col-sm-4 label-col" for="comment">Phone Number</label>
            <div class="col-sm-8 info-col">
              {{util.maskPhoneNumber(user.mobile_no)}}
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 userSection" *ngIf="isEdit">
        <div class="row" *ngFor="let user of users.controls; let indx=index" [formGroup]="user">
          <div *ngIf="user.get('is_delete').value == '0'">
            <div class="col-md-6 selPart control-label pageSubTitle" *ngIf="indx == 0">
              <span>Primary User</span>
            </div>
            <div class="col-md-6 selPart control-label pageSubTitle" *ngIf="indx != 0">
              <span class="closeBtnWrap">
                <img class="cursorPtr" (click)="removeUser(indx, user)" src="assets/icon/close_icon.png">
              </span>
              <span>User {{indx + 1}}</span>
            </div>
            <div class="clearfix"></div>
            <div class="form-group clearfix">
              <label class="col-sm-4 control-label" for="name">Name</label>
              <div class="col-sm-8">
                <input autocomplete="nope" type="text" name="name" placeholder="" formControlName="name"
                  class="form-control">
                <span class="error-msg"
                  *ngIf="user.get('name').invalid && (user.get('name').dirty || user.get('name').touched || submitted)">
                  <small *ngIf="user.get('name').errors.required">Name is required.</small>
                  <small *ngIf="user.get('name').errors.minlength">Name must be at least 2 characters long.</small>
                  <small *ngIf="user.get('name').errors.maxlength">Name must be less than 30 characters.</small>
                </span>
              </div>
            </div>

            <div class="form-group clearfix">
              <label class="col-sm-4 control-label" for="username">Username</label>
              <div class="col-sm-8">
                <input autocomplete="nope" type="text" id="username" name="username" formControlName="username"
                  class="form-control optional" (keypress)="util.noSpace($event)"
                  [ngClass]="user.get('user_id').value != '' ? 'ptrN' : ''" (mouseleave)="validateUsername(user)">
                <span class="error-msg"> <small *ngIf="user.get('isValidUserName').value">Username already
                    exists.</small></span>
                <span class="error-msg"
                  *ngIf="user.get('username').invalid && (user.get('username').dirty || user.get('username').touched || submitted)">
                  <small *ngIf="user.get('username').errors.required">Username is required.</small>
                  <small *ngIf="user.get('username').errors.minlength">Username must be at least 8 characters
                    long.</small>
                  <small *ngIf="user.get('username').errors.maxlength">Username must be less than 30 characters.</small>
                </span>
              </div>
            </div>

            <div class="form-group clearfix">
              <label class="col-sm-4 control-label" for="designation">Designation</label>
              <div class="col-sm-8">
                <input autocomplete="nope" type="text" name="designation" placeholder="" formControlName="designation"
                  class="form-control">
                <span class="error-msg"
                  *ngIf="user.get('designation').invalid && (user.get('designation').dirty || user.get('designation').touched || submitted)">
                  <small *ngIf="user.get('designation').errors.required">Designation is required.</small>
                  <small *ngIf="user.get('designation').errors.minlength">Designation must be at least 2 characters
                    long.</small>
                  <small *ngIf="user.get('designation').errors.maxlength">Designation must be less than 30
                    characters.</small>
                </span>
              </div>
            </div>
            <div class="form-group clearfix">
              <label class="col-sm-4 control-label" for="email_id">Email</label>
              <div class="col-sm-8">
                <input autocomplete="nope" type="text" name="email_id" placeholder="" formControlName="email_id"
                  class="form-control" (mouseleave)="validateEmail(user)">
                <span class="error-msg"> <small *ngIf="user.get('isValidEmail').value">Email already
                    exists.</small></span>
                <span class="error-msg"
                  *ngIf="user.get('email_id').invalid && (user.get('email_id').dirty || user.get('email_id').touched || submitted)">
                  <small *ngIf="user.get('email_id').errors.required">Email is required.</small>
                  <small *ngIf="user.get('email_id').errors.pattern">Enter valid email.</small>
                </span>
              </div>
            </div>
            <div class="form-group clearfix">
              <label class="col-sm-4 control-label" for="mobile_no">Phone Number</label>
              <div class="col-sm-8">
                <input autocomplete="nope" type="text" [textMask]="{mask: constant.PHONE_NUMBER_MASK}" name="mobile_no"
                  placeholder="" formControlName="mobile_no" class="form-control">
                <span class="error-msg"
                  *ngIf="user.get('mobile_no').invalid && (user.get('mobile_no').dirty || user.get('mobile_no').touched || submitted)">
                  <small *ngIf="user.get('mobile_no').errors.required">Phone Number is required.</small>
                  <small *ngIf="user.get('mobile_no').errors.pattern">Enter valid Phone Number.</small>
                </span>
              </div>
            </div>


            <div class="form-group clearfix" *ngIf="user.get('user_id').value != ''">
              <label class="col-sm-4 control-label" for="mobile_no">&nbsp;</label>
              <!-- @ Shahebaz (Start)-->
              <div class="button-row clearfix col-sm-8">
                <button mat-raised-button class="trea-btn" type="button"
                  (click)="resetPassword(user.get('username').value)">Reset Password</button>
              </div>
              <!-- @ Shahebaz (End)-->
            </div>


          </div>
          <div class="clearfix"></div>
        </div>
        <div class="newUserbtnwrap" *ngIf="isEdit && userCount < 3">
          <div class="addIcon">
            <span class="cursorPtr" (click)="addUser('0', {})">
              <img src="assets/icon/icon-add.png" /><span>New User</span>
            </span>
          </div>
        </div>
      </div>


    </form>
  </div>
  <div class="errMsgCon" *ngIf="isError">
    <small>{{errMsg}}</small>
  </div>
  <div *ngIf="isEdit" class="button-row clearfix">
    <button type="button" mat-raised-button id="updateComp" class="trea-btn"
      (click)="updateCompanyDetails(editAccDetailsFrm)">Update</button>
    <button type="button" mat-raised-button (click)="cancelEdit()" class="trea-btn">Cancel</button>
  </div>
</div>
