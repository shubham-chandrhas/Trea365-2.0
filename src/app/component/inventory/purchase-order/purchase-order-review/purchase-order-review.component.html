<div id="poMark"></div>
<div class="inventory-section purchaseorderreviewWrap" *ngIf="!editMode">
  <h3 class="pageTitle" *ngIf="!isExistingOrder">New Purchase Order Review</h3>
  <h3 class="pageTitle" *ngIf="isExistingOrder">Purchase Order
    {{pageData.purchase_order_no ? pageData.purchase_order_no : ""}} <span
      *ngIf="orderStatus && orderStatus != ''">({{orderStatus}})</span></h3>
  <div class="clearfix"></div>
  <div class="container-fluid">
    <div class="selSection">
      <div class="clearfix"></div>
      <div class="purchaseorderDetails">
        <div class="row">
          <div class="col-sm-6">
            <div class="row">
              <div class="col-sm-6">
                <div class="label-col">Date</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col" *ngIf="!isExistingOrder">{{util.getFormatedDate(today)}}</div>
                <div class="info-col" *ngIf="isExistingOrder">
                  {{util.getFormatedDate(pageData.purchase_order_date && pageData.purchase_order_date != '' ? pageData.purchase_order_date : today)}}
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="label-col">Generated by</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">{{userInfo.first_name}}</div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="label-col">Supplier</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">{{pageData.supplierName}}</div>
              </div>
            </div>
          </div>
          <div class="col-sm-6" *ngIf="pageData.supplier">

            <div class="row">
              <div class="col-sm-6">
                <div class="label-col">Phone</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">{{pageData.supplier.phone_no ? pageData.supplier.phone_no : 'N/A' }}</div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="label-col">Email</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">{{pageData.supplier.email_id ? pageData.supplier.email_id : 'N/A' }}</div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="label-col">Address</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">
                  {{pageData.supplier.address1 ? util.concatenateStrings(pageData.supplier.address2,pageData.supplier.address1) : 'N/A' }}
                </div>
              </div>
            </div>

            <div class="row" *ngIf="pageData.email_logs">
              <div class="col-sm-6">
                <div class="label-col">Date sent</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">{{util.getFormatedDate(pageData.email_logs.created_at)}}</div>
              </div>
            </div>


            <div class="row" *ngIf="pageData.email_logs">
              <div class="col-sm-6">
                <div class="label-col">Sent by</div>
              </div>
              <div class="col-sm-6">
                <div class="info-col">{{userInfo.first_name}}</div>
              </div>
            </div>

          </div>
        </div>


        <div class="row" *ngIf="pageData.email_logs">
          <div class="col-sm-3">
            <div class="label-col">Email Status</div>
          </div>
          <div class="col-sm-6">
            <div class="info-col">Sent On {{util.getFormatedDate(pageData.email_logs.updated_at) }} to <span
                class="email">{{pageData.email_logs.email_to}}</span>
            </div>
            <button *ngIf=" pageData.status != 'Cancelled' " mat-raised-button class="trea-btn"
              (click)="resendMail(pageData.email_logs, pageData.purchase_order_id)" id="resendEmail">Resend</button>
          </div>
        </div>

      </div>
      <div class="clearfix"></div>
      <div class="purchaseitemDetails" *ngIf="pageData.purchaseOrder && pageData.purchaseOrder.items">
        <div class="serPart text-center">
          <span>Purchase Items</span>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Manufacturer</th>
                <th>Item Definition</th>
                <th class="text-right">Qty Ordered (Units)</th>
                <th class="text-right">Price/Unit</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of pageData.purchaseOrder.items; let indx=index">
                <td>{{item.manf_name}}</td>
                <td>{{item.item_definition_name}}</td>
                <td class="text-right">{{item.quantity_ordered}} {{item.uom ? item.uom : ''}}</td>
                <td class="text-right">
                  {{item.price_per_unit | currency: util.getCurrency() :'symbol-narrow'}}
                </td>
              </tr>
            </tbody>

          </table>
        </div>
      </div>
      <div class="clearfix"></div>
      <div class="commentDetails">
        <div class="row">
          <div class="col-sm-12">
            <div class="row">
              <div class="col-sm-2">
                <div class="label-col">Comment</div>
              </div>
              <div class="col-sm-10">
                <div class="info-col" *ngIf="pageData.purchaseOrder">{{pageData.purchaseOrder.comment ? pageData.purchaseOrder.comment : 'N/A'}}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>

      <div class="errMsgCon" *ngIf="totalPayErr">
        <small>{{errMsg}}</small>
      </div>
      <div class="clearfix"></div>

      <div class="button-row clearfix" *ngIf="!orderStatus" canAccess="po_create">
        <button mat-raised-button (click)="editPurchaseOrder(pageData, 'backup')" class="trea-btn">Edit</button>
        <button mat-raised-button class="trea-btn" (click)="createPurchaseOrder(1)" id="addData">Save</button>
        <button mat-raised-button class="trea-btn" (click)="approvePOFromReview(pageData, '1')"
          id="approvePO">Approve</button>
        <button mat-raised-button class="trea-btn" (click)="sendOrderToSupplier(pageData, '1')"
          id="sendOrderToSupplier1">Send Order to Supplier</button>
        <button mat-raised-button (click)="cancel()" class="trea-btn">Cancel</button>
      </div>

      <div class="button-row clearfix" *ngIf="orderStatus == 'Saved'" canAccess="po_create">
        <div>
          <button mat-raised-button (click)="editPurchaseOrder(pageData, '')" class="trea-btn">Edit</button>
          <button mat-raised-button class="trea-btn" (click)="approvePurchaseOrder(pageData)"
            id="approvePurchaseOrder">Approve</button>

          <button mat-raised-button class="trea-btn" (click)="cancelPurchaseOrder(pageData)"
            id="cancelPurchaseOrder">Cancel P/O</button>


          <button mat-raised-button class="trea-btn" (click)="sendOrderToSupplier(pageData, '2')"
            id="sendOrderToSupplier2">Send Order to Supplier</button>
          <button mat-raised-button class="trea-btn" (click)="deletePurchaseOrder(pageData)"
            id="sendOrderToSupplier2">Delete</button>
        </div>
      </div>

      <div class="button-row clearfix" *ngIf="orderStatus == 'Received'" canAccess="po_create">
        <div>
          <button mat-raised-button (click)="editPurchaseOrder(pageData, '')" class="trea-btn">Edit</button>
          <button mat-raised-button class="trea-btn" (click)="sendOrderToSupplier(pageData, '2')"
            id="sendOrderToSupplier2">Send Order to Supplier</button>
          <button mat-raised-button class="trea-btn" (click)="deletePurchaseOrder(pageData)"
            id="sendOrderToSupplier2">Delete</button>
        </div>
      </div>

      <div class="button-row clearfix" *ngIf="orderStatus == 'Completed'" canAccess="po_create">
        <div>
          <button mat-raised-button class="trea-btn" (click)="deletePurchaseOrder(pageData)"
            id="sendOrderToSupplier2">Delete</button>
        </div>
      </div>

      <div class="button-row clearfix" *ngIf="orderStatus == 'Partial'" canAccess="po_create">
        <button mat-raised-button (click)="receiveItems(pageData)" class="trea-btn">Continue Receiving</button>
      </div>


      <div class="button-row clearfix" *ngIf="orderStatus == 'Sent'" canAccess="po_create">
        <button mat-raised-button (click)="receiveItems(pageData)" canAccess="rs_create" class="trea-btn">Create
          R/S</button>
        <button mat-raised-button class="trea-btn" (click)="approvePurchaseOrder(pageData)"
          id="approvePurchaseOrder">Approve</button>

        <button mat-raised-button class="trea-btn" (click)="cancelPurchaseOrder(pageData)"
          id="cancelPurchaseOrder">Cancel P/O</button>

        <button mat-raised-button *ngIf="!pageData.email_logs" class="trea-btn"
          (click)="sendOrderToSupplier(pageData, '2')" id="sendOrderToSupplier2">Resend</button>
      </div>


    </div>
  </div>
</div>
<div *ngIf="editMode">
  <app-new-purchase-order></app-new-purchase-order>
</div>
